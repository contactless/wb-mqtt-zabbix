#!/usr/bin/env python
import click
import paho.mqtt.client as mqtt
from wb_mqtt_zabbix import MQTTHandler

PORT_VALUE = click.IntRange(1, 65535)


@click.command()
@click.option("-c", "--conf-file", default="/etc/wb-mqtt-zabbix.conf", help="Config file")
@click.option("-d", "--debug", is_flag=True)
@click.option("-h", "--mqtt-host", help="MQTT host")
@click.option("-p", "--mqtt-port", type=PORT_VALUE, help="MQTT port")
@click.option("-t", "--mqtt-topic", help="MQTT subsctiption topic")
@click.option("-H", "--zabbix-server", help="Zabbix server")
@click.option("-P", "--zabbix-port", type=PORT_VALUE, help="Zabbix port")
@click.option("-z", "--zabbix-host-name", help="Host name as registered in Zabbix frontend")
def zbridge(**kwargs):
    """Zabbix bridge for Wiren Board."""
    client = mqtt.Client()
    handler = MQTTHandler(client, **{k: v for k, v in kwargs.items() if v is not None})
    handler.connect()
    client.loop_forever()

if __name__ == "__main__":
    zbridge()
